// Code generated by protoc-gen-resty. DO NOT EDIT.
// versions:
// - protoc-gen-resty v0.1.0
// - protoc           v3.17.3
// source: proto/sqlx/code.proto

package sqlx_pb

import (
	context "context"
	v2 "github.com/go-resty/resty/v2"
	go_json "github.com/goccy/go-json"
	lava "github.com/pubgo/lava/proto/lava"
	reflect "reflect"
	strings "strings"
)

type CodeResty interface {
	// 发送
	SendCode(ctx context.Context, in *SendCodeRequest, opts ...func(req *v2.Request)) (*SendCodeResponse, error)
	// 校验
	Verify(ctx context.Context, in *VerifyRequest, opts ...func(req *v2.Request)) (*VerifyResponse, error)
	// 是否校验图片验证码
	IsCheckImageCode(ctx context.Context, in *IsCheckImageCodeRequest, opts ...func(req *v2.Request)) (*IsCheckImageCodeResponse, error)
	// 校验图片验证码
	VerifyImageCode(ctx context.Context, in *VerifyImageCodeRequest, opts ...func(req *v2.Request)) (*VerifyImageCodeResponse, error)
	// 获取发送状态
	GetSendStatus(ctx context.Context, in *GetSendStatusRequest, opts ...func(req *v2.Request)) (*GetSendStatusResponse, error)
}

func NewCodeResty(client *v2.Client) CodeResty {
	client.SetContentLength(true)
	return &codeResty{client: client}
}

type codeResty struct {
	client *v2.Client
}

func (c *codeResty) SendCode(ctx context.Context, in *SendCodeRequest, opts ...func(req *v2.Request)) (*SendCodeResponse, error) {
	var req = c.client.R()
	if ctx != nil {
		req.SetContext(ctx)
	}
	for i := range opts {
		opts[i](req)
	}
	var body map[string]interface{}
	if in != nil {
		var rv = reflect.ValueOf(in).Elem()
		var rt = reflect.TypeOf(in).Elem()
		for i := 0; i < rt.NumField(); i++ {
			if val, ok := rt.Field(i).Tag.Lookup("param"); ok && val != "" {
				req.SetPathParam(val, rv.Field(i).String())
				continue
			}
			if val, ok := rt.Field(i).Tag.Lookup("query"); ok && val != "" {
				req.SetQueryParam(val, rv.Field(i).String())
				continue
			}
			if body == nil {
				body = make(map[string]interface{})
			}
			if val, ok := rt.Field(i).Tag.Lookup("json"); ok && val != "" {
				body[val] = rv.Field(i).String()
			}
		}
	}
	req.SetBody(body)
	var resp, err = req.Execute("POST", "/user/code/send-code")
	if err != nil {
		return nil, err
	}
	out := new(SendCodeResponse)

	var headers = make(map[string]string)
	for k, v := range resp.Header() {
		headers[k] = strings.Join(v, ",")
	}
	out.Response = &lava.Response{
		Code:    int32(resp.StatusCode()),
		Headers: headers,
	}
	if err := go_json.Unmarshal(resp.Body(), out); err != nil {
		return nil, err
	}
	return out, nil
}

func (c *codeResty) Verify(ctx context.Context, in *VerifyRequest, opts ...func(req *v2.Request)) (*VerifyResponse, error) {
	var req = c.client.R()
	if ctx != nil {
		req.SetContext(ctx)
	}
	for i := range opts {
		opts[i](req)
	}
	var body map[string]interface{}
	if in != nil {
		var rv = reflect.ValueOf(in).Elem()
		var rt = reflect.TypeOf(in).Elem()
		for i := 0; i < rt.NumField(); i++ {
			if val, ok := rt.Field(i).Tag.Lookup("param"); ok && val != "" {
				req.SetPathParam(val, rv.Field(i).String())
				continue
			}
			if val, ok := rt.Field(i).Tag.Lookup("query"); ok && val != "" {
				req.SetQueryParam(val, rv.Field(i).String())
				continue
			}
			if body == nil {
				body = make(map[string]interface{})
			}
			if val, ok := rt.Field(i).Tag.Lookup("json"); ok && val != "" {
				body[val] = rv.Field(i).String()
			}
		}
	}
	req.SetBody(body)
	var resp, err = req.Execute("POST", "/user/code/verify")
	if err != nil {
		return nil, err
	}
	out := new(VerifyResponse)
	if err := go_json.Unmarshal(resp.Body(), out); err != nil {
		return nil, err
	}
	return out, nil
}

func (c *codeResty) IsCheckImageCode(ctx context.Context, in *IsCheckImageCodeRequest, opts ...func(req *v2.Request)) (*IsCheckImageCodeResponse, error) {
	var req = c.client.R()
	if ctx != nil {
		req.SetContext(ctx)
	}
	for i := range opts {
		opts[i](req)
	}
	var body map[string]interface{}
	if in != nil {
		var rv = reflect.ValueOf(in).Elem()
		var rt = reflect.TypeOf(in).Elem()
		for i := 0; i < rt.NumField(); i++ {
			if val, ok := rt.Field(i).Tag.Lookup("param"); ok && val != "" {
				req.SetPathParam(val, rv.Field(i).String())
				continue
			}
			if val, ok := rt.Field(i).Tag.Lookup("query"); ok && val != "" {
				req.SetQueryParam(val, rv.Field(i).String())
				continue
			}
			if body == nil {
				body = make(map[string]interface{})
			}
			if val, ok := rt.Field(i).Tag.Lookup("json"); ok && val != "" {
				body[val] = rv.Field(i).String()
			}
		}
	}
	req.SetBody(body)
	var resp, err = req.Execute("POST", "/user/code/is-check-image-code")
	if err != nil {
		return nil, err
	}
	out := new(IsCheckImageCodeResponse)
	if err := go_json.Unmarshal(resp.Body(), out); err != nil {
		return nil, err
	}
	return out, nil
}

func (c *codeResty) VerifyImageCode(ctx context.Context, in *VerifyImageCodeRequest, opts ...func(req *v2.Request)) (*VerifyImageCodeResponse, error) {
	var req = c.client.R()
	if ctx != nil {
		req.SetContext(ctx)
	}
	for i := range opts {
		opts[i](req)
	}
	var body map[string]interface{}
	if in != nil {
		var rv = reflect.ValueOf(in).Elem()
		var rt = reflect.TypeOf(in).Elem()
		for i := 0; i < rt.NumField(); i++ {
			if val, ok := rt.Field(i).Tag.Lookup("param"); ok && val != "" {
				req.SetPathParam(val, rv.Field(i).String())
				continue
			}
			if val, ok := rt.Field(i).Tag.Lookup("query"); ok && val != "" {
				req.SetQueryParam(val, rv.Field(i).String())
				continue
			}
			if body == nil {
				body = make(map[string]interface{})
			}
			if val, ok := rt.Field(i).Tag.Lookup("json"); ok && val != "" {
				body[val] = rv.Field(i).String()
			}
		}
	}
	req.SetBody(body)
	var resp, err = req.Execute("POST", "/user/code/verify-image-code")
	if err != nil {
		return nil, err
	}
	out := new(VerifyImageCodeResponse)
	if err := go_json.Unmarshal(resp.Body(), out); err != nil {
		return nil, err
	}
	return out, nil
}

func (c *codeResty) GetSendStatus(ctx context.Context, in *GetSendStatusRequest, opts ...func(req *v2.Request)) (*GetSendStatusResponse, error) {
	var req = c.client.R()
	if ctx != nil {
		req.SetContext(ctx)
	}
	for i := range opts {
		opts[i](req)
	}
	var body map[string]interface{}
	if in != nil {
		var rv = reflect.ValueOf(in).Elem()
		var rt = reflect.TypeOf(in).Elem()
		for i := 0; i < rt.NumField(); i++ {
			if val, ok := rt.Field(i).Tag.Lookup("param"); ok && val != "" {
				req.SetPathParam(val, rv.Field(i).String())
				continue
			}
			if val, ok := rt.Field(i).Tag.Lookup("query"); ok && val != "" {
				req.SetQueryParam(val, rv.Field(i).String())
				continue
			}
			if body == nil {
				body = make(map[string]interface{})
			}
			if val, ok := rt.Field(i).Tag.Lookup("json"); ok && val != "" {
				body[val] = rv.Field(i).String()
			}
		}
	}
	req.SetBody(body)
	var resp, err = req.Execute("POST", "/user/code/get-send-status")
	if err != nil {
		return nil, err
	}
	out := new(GetSendStatusResponse)
	if err := go_json.Unmarshal(resp.Body(), out); err != nil {
		return nil, err
	}
	return out, nil
}
